## x86 汇编指令集大全

---

### Inter 和 AT&T 指令差异

| 差异                   | Inter(nasm)                                                                     | AT&T(gcc)                                                         |
| ---------------------- | ------------------------------------------------------------------------------- | ----------------------------------------------------------------- |
| 引用寄存器名字         | eax                                                                             | %eax                                                              |
| 赋值操作数顺序         | mov dest, src<br />(dest <- src)                                                | movl src, dest<br />(src = dest)                                  |
| 寄存器、立即数指令前缀 | mov ebx, 0xd00d                                                                 | movl $0xd00d, %ebx                                                |
| 寄存器间接寻址         | [eax]                                                                           | (%eax)                                                            |
| 数据类型大小           | 操作码后加后缀字母，“l” 32位，“w” 16位，“b” 8位（mov dx, word ptr [eax]） | 操作数前面加dword ptr， word ptr，byte ptr的格式 （movb %bl %al） |

---

### 简单传送指令

| 指令    | 中文名       | 格式                 | 解释                                                  | 备注                                                                           |
| ------- | ------------ | -------------------- | ----------------------------------------------------- | ------------------------------------------------------------------------------ |
| mov     | 传送指令     | mov dest, src        | dest <- src                                           | dest 不能是立即数                                                              |
| xchg    | 交换指令     | xchg oper1, oper2    | 把操作数oper1的内容与操作数oper2的内容交换            | oper1和oper2可以是通用寄存器或存储单元，但不能同时是操作单元，也不能是立即数。 |
| cmpxchg | 比较交换指令 | cmpxchg oper1, oper2 | 比较并交换操作数（第二个操作数必须为累计器al/ax/eax） | 用来设计自旋锁，保证原子性（cmpchg byte [0x100], 1）                           |
| xadd    | 交换累加指令 | xadd oper1, oper2    | 先交换在累加（结果在第一个操作数）                    |                                                                                |

---

### 扩展传送指令

| 指令  | 中文名           | 格式            | 解释                                      | 备注                                                      |
| ----- | ---------------- | --------------- | ----------------------------------------- | --------------------------------------------------------- |
| movsx | 符号拓展传送指令 | movsx dest, src | 把源操作数src符号拓展后送至目的操作数dest | src可以是通用寄存器或者存储单元，但是dest只能是通用寄存器 |
| movzx | 零扩展传送指令   | movzx dest, src | 把源操作数src零拓展后送至目的操作数dest   | 零拓展传送指令不会改变源操作数，也不影响标志寄存器的状态  |

---

### 简单加减指令

| 指令 | 中文名   | 格式            | 解释              | 备注                   |
| ---- | -------- | --------------- | ----------------- | ---------------------- |
| add  | 加法指令 | add  dest, src | dest = dest + src | dest 不能是立即数      |
| sub  | 减法指令 | sub dest, src   | dest = dest - src | dest 不能是立即数      |
| inc  | 加一指令 | inc dest        | dest = dest + 1   | dest 不能是立即数      |
| dec  | 减一指令 | dec dest        | dest = dest - 1   | dest 不能是立即数      |
| neg  | 取补指令 | neg oprd        | oprd = 0 - oprd   | 对操作数取补（相反数） |

---

### 端口传送指令

| 指令 | 中文名       | 格式       | 解释     | 备注                       |
| ---- | ------------ | ---------- | -------- | -------------------------- |
| in   | I/O 端口输入 | in ax, dx  | ax <- dx | 将端口（dx）的值传送给 ax  |
| out  | I/O 端口输出 | out dx, ax | ax -> dx | 将 ax 的值传送给端口（dx） |

---

### 逻辑运算指令

| 指令 | 中文名     | 格式           | 解释                                                                                                              | 备注                                                |
| ---- | ---------- | -------------- | ----------------------------------------------------------------------------------------------------------------- | --------------------------------------------------- |
| not  | 否运算指令 | not oprd       | 把操作数oprd按位取反，然后送回oprd                                                                                | 0得1，1得0                                          |
| and  | 与运算指令 | and dest, src  | 把两个操作数进行与运算之后结果送回dest                                                                            | 同1得1，否则得0                                     |
| or   | 或运算指令 | or dest, src   | 把两个操作数进行或运算之后结果送回dest                                                                            | 同0得0，否则得1                                     |
| xor  | 异或运算   | xor dest, src  | 把两个操作数进行异或运算之后结果送回dest                                                                          | 相同得0不同得1                                      |
| test | 测试指令   | test dest, src | 与and指令类似，将各位相与，但是结果不送回dest，仅影响状态位标志，指令执行后，ZF、PF、SF反映运算结果，CF和OF被清零 | 通常用于检测某些位是否为1，但又不希望改变操作数的值 |

---

### 一般位移指令

| 指令 | 中文名   | 格式            | 解释                                                       | 备注                                                           |
| ---- | -------- | --------------- | ---------------------------------------------------------- | -------------------------------------------------------------- |
| shl  | 逻辑左移 | shl oprd, count | 把操作数oprd左移count位，右边补0                           | 与sal指令一样通过截取count的低5位，实际的移位数被限于0到31之间 |
| shr  | 逻辑右移 | shr oprd, count | 把操作数oprd右移count位，左边补0，移出的最低位进入标志位CF | 通过截取count的低5位，实际的移位数被限于0到31之间              |

---

### 算术运算指令

| 指令 | 中文名           | 8位                         | 16位                            | 32位                                | 备注                                  |
| ---- | ---------------- | --------------------------- | ------------------------------- | ----------------------------------- | ------------------------------------- |
| mul  | 无符号数乘法指令 | al * (reg/mem8) = ax        | ax * (reg/mem16) = dx:ax        | eax * (reg/mem32) = edx:eax         | 成功乘数告诉CPU做几位乘法             |
| div  | 无符号数除法指令 | ax / (reg/mem8) = al ... ah | dx:ax / (reg/mem16) = ax ... dx | edx:eax / (reg/mem32) = eax ... edx | 连续除法时（进制换算），只需将余数清0 |

---

### 堆栈操作指令

| 指令   | 中文名                   | 格式     | 解释                                                               | 备注                                                                                                                            |
| ------ | ------------------------ | -------- | ------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------- |
| push   | 进栈指令                 | push src | 把源操作数src压入堆栈                                              | 源操作数src可以是32位通用寄存器、16位通用寄存器和段寄存器，也可以是双字存储单元或者字符存储单元，还可以是立即数                 |
| pop    | 出栈指令                 | pop dest | 从栈顶弹出一个双字或字数据到目的操作数                             | 如果目的操作数是双字的，那么就从栈顶弹出一个双字数据，否则，从栈顶弹出一个字数据，出栈至少弹出一个字（16位）                    |
| pusha  | 16位通用寄存器全进栈指令 | pusha    | 将所有8个16位通用寄存器的内容压入堆栈                              | 压入顺序是ax、cx、dx、bx、sp、bp、si、di，然后堆栈指针寄存器sp的值减16，所以sp进栈的内容是pusha指令执行之前的值                 |
| popa   | 16位通用寄存器全出栈指令 | popa     | 以pusha相反的顺序从堆栈中弹出内容，从而恢复pusha之前的寄存器状态   | sp的值不是由堆栈弹出的，而是通过增加16来恢复                                                                                    |
| pushad | 32位通用寄存器全进栈指令 | pushad   | 将所有8个32位通用寄存器的内容压入堆栈                              | 压入顺序是eax、ecx、edx、 ebx、 esp、 ebp、 esi、 edi，然后堆栈指针寄存器esp的值减32，所以esp进栈的内容是pushad指令执行之前的值 |
| popad  | 32位通用寄存器全出栈指令 | popad    | 以pushad相反的顺序从堆栈中弹出内容，从而恢复pushad之前的寄存器状态 | esp的值不是由堆栈弹出的，而是通过增加32来恢复                                                                                   |

---

### 条件跳转指令

| 指令    | 说明                     |
| ------- | ------------------------ |
| je/jz   | 等于跳转（==）           |
| jne/jnz | 不等于跳转（!=）         |
| ja/jnbe | 无符号大于跳转（>）      |
| jna/jbe | 无符号不大于跳转 (<=)    |
| jae/jnb | 无符号大于等于跳转（>=） |
| jnae/jb | 无符号不大于等于跳转 (<) |

---

### 串操作指令

| 特性 | 要对多少数据进行操作？                 | 数据串长度    |
| ---- | -------------------------------------- | ------------- |
| 特性 | 数据串操作方向（从低到高还是从高到低） | 串操作方向    |
| 共性 | 到底进行何种操作？                     | 操作指令      |
| 共性 | 数据从哪里来又到哪里去？               | 源/目标操作数 |

---

| 相关寄存器                | 串操作属性              |
| ------------------------- | ----------------------- |
| cx 计数寄存器             | 数据串长度/操作重复次数 |
| FLAGS标志寄存器中DF标志位 | 数据串操作方向          |

---

| 指令 | DF标志位状态 | 连续操作方向     |
| ---- | ------------ | ---------------- |
| cld  | 0            | 从低地址到高地址 |
| sld  | 1            | 从高地址到低地址 |

---

| 指令        | 重复执行条件      |
| ----------- | ----------------- |
| rep         | cx 不为0          |
| repz/repe   | cx 不为0且 ZF = 1 |
| repnz/repne | cx 不为0且 ZF = 0 |

---

| 地址指针     | 源变址寄存器si、目的变址寄存器di |
| ------------ | -------------------------------- |
| 串操作方向   | DF的状态                         |
| 重复执行前缀 | rep、repz/repe、repnz/repne      |

---

#### 串传送指令

| 串操作指令格式 | 目的操作数 | 源操作数 | 操作数字长 |
| -------------- | ---------- | -------- | ---------- |
| movs si di     | es:di      | ds:si    | 字节或字   |
| movsb          | 隐含寻址   | 隐含寻址 | 字节       |
| movsw          | 隐含寻址   | 隐含寻址 | 字         |

---

#### 串比较指令

| 串操作指令格式 | 目的操作数 | 源操作数 | 操作数字长 |
| -------------- | ---------- | -------- | ---------- |
| cmps           | es:di      | ds:si    | 字节或字   |
| cmpsb          | 隐含寻址   | 隐含寻址 | 字节       |
| cmpsw          | 隐含寻址   | 隐含寻址 | 字         |

---

#### 串扫描指令

| 串操作指令格式 | 目标操作数 | 比较操作数 | 操作数字长 |
| -------------- | ---------- | ---------- | ---------- |
| scas           | es:di      | al/ax      | 字节或字   |
| scasb          | 隐含寻址   | al         | 字节       |
| scasw          | 隐含寻址   | ax         | 字         |

---

#### 串装入指令

| 串操作指令格式 | 目的操作数 | 源操作数 | 操作数字长 |
| -------------- | ---------- | -------- | ---------- |
| lods           | al/ax      | ds:si    | 字节或字   |
| lodsb          | al         | 隐含寻址 | 字节       |
| lodsw          | ax         | 隐含寻址 | 字         |

---

#### 串存储指令

| 串操作指令格式 | 目的操作数 | 源操作数 | 操作数字长 |
| -------------- | ---------- | -------- | ---------- |
| stos           | es:di      | al/ax    | 字节或字   |
| stosb          | 隐含寻址   | al       | 字节       |
| stosw          | 隐含寻址   | ax       | 字         |

---

### 伪指令

| 伪指令 | 说明                                                            | 示例                  |
| ------ | --------------------------------------------------------------- | --------------------- |
| org    | 告诉编译器当前程序起始地址（默认0），物理位置=起始地址+相对偏移 | org BaseOfBoot        |
| equ    | 定义常量                                                        | BaseOfBoot equ 0x7c00 |
| $      | 当前指令或数据地址                                              |                       |
| $$     | 当前节（section）的起始地址                                     |                       |
| db     | 定义字节型变量，每个变量分配1个存储单元（8位 - byte）           |                       |
| dw     | 定义字型变量，每个变量分配2个存储单元（16位 - word）            |                       |
| dd     | 定义双字型变量，每个变量分配4个存储单元（32位 - double word）   |                       |
| dq     | 定义四字型变量，每个变量分配8个存储单元（64位 - quadra word）  |                       |
| dt     | 定义十字型变量，每个变量分配10个存储单元（80位 - TBYTE）        |                       |
